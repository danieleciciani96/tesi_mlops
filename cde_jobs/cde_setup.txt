### Setuo cde
mkdir .cde

nano .cde/config.yaml
user: dciciani
vcluster-endpoint: https://6kzk56hf.cde-zgcqdkbm.ps-sandb.a465-9q4k.cloudera.site/dex/api/v1

# Manually upload the CDE CLI before running the below commands:
mkdir /home/cdsw/.local/bin
chmod 777 /home/cdsw/.local/bin
cp lib/cde /home/cdsw/.local/bin
chmod 777 /home/cdsw/.local/bin/cde

### create Python CDE Resources
cde resource create --name python-res-mlops --type python-env --python-version python3
cde resource list --filter name[rlike]python-res-mlops


# Upload the requirements file for the cde python env
cde resource upload --name python-res-mlops --local-path ${HOME}/cde_jobs/requirements.txt --resource-path requirements.txt

# Check the status of the environment
cde resource list-events --name python-res-mlops

### Create a File Resource
cde resource create --name file-res-mlops --type files

# upload files into Resource
cde resource upload --name file-res-mlops --local-path cde_jobs/0_refresh_raw.py
cde resource upload --name file-res-mlops --local-path cde_jobs/mlops_airflow_dag.py
cde resource upload --name file-res-mlops --local-path lib/iceberg-spark-runtime-3.2_2.12-0.13.2.jar


# Create the spark job refresh_raw
cde job create --type spark \
               --python-env-resource-name python-res-mlops \
               --mount-1-resource file-res-mlops \
               --application-file 0_refresh_raw.py \
               --name 0_refresh_raw


# Create the Airflow Job CICD_Pipeline
cde job create --type airflow \
               --dag-file mlops_airflow_dag.py \
               --mount-1-resource file-res-mlops \
               --name cicd_pipeline_mlops




### to delete
"""
# Create the spark job refresh_raw
cde job create --name 0_refresh_raw --type spark \
               --mount-1-prefix appFiles/ \
               --mount-1-resource file-res-mlops \
               --python-env-resource-name python-res-mlops \
               --conf spark.executorEnv.PYTHONPATH=/app/mount/appFiles/deps_udf.zip \
               --py-file /app/mount/appFiles/deps_udf.zip \
               --application-file /app/mount/appFiles/sklearn_dependency.py 


"""